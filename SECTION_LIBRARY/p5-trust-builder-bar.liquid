{% comment %}
  NZDev Section Installer â€“ Highlights Bar (aka Trust Builder Bar)
  One-file section: Liquid + CSS + JS

  NOTE: This file is the payload that the NZDev app will install into merchant themes.
{% endcomment %}

<div
  class="p5-trustbar color-{{ section.settings.color_scheme }} gradient"
  data-section-id="{{ section.id }}"
  data-track-clicks="{{ section.settings.track_clicks | json }}"
  style="
    --p5tb-max-width: {{ section.settings.max_width }}px;
    --p5tb-padding-y: {{ section.settings.padding_y }}px;
    --p5tb-gap: {{ section.settings.gap }}px;
    --p5tb-radius: {{ section.settings.radius }}px;
    --p5tb-border: {{ section.settings.border_width }}px;
    --p5tb-bg-alpha: {{ section.settings.bg_alpha | divided_by: 100.0 }};
    --p5tb-icon-size: {{ section.settings.icon_size }}px;
    --p5tb-text-size: {{ section.settings.text_size }}px;
  "
>
  <div class="p5-trustbar__inner page-width" style="--p5tb-cols: {{ section.settings.cols }}; --p5tb-cols-md: {{ section.settings.cols_md }}; --p5tb-cols-sm: {{ section.settings.cols_sm }};">
    {%- if section.settings.heading != blank -%}
      <p class="p5-trustbar__heading {{ section.settings.heading_size }}">{{ section.settings.heading | escape }}</p>
    {%- endif -%}

    <ul class="p5-trustbar__list" role="list" aria-label="{{ section.settings.aria_label | escape }}">
      {%- for block in section.blocks -%}
        {%- if block.type == 'item' -%}
          <li class="p5-trustbar__item" {{ block.shopify_attributes }}>
            {%- if block.settings.link != blank -%}
              <a
                class="p5-trustbar__link"
                href="{{ block.settings.link }}"
                {% if block.settings.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}
                data-p5tb-link
                data-label="{{ block.settings.text | escape }}"
              >
            {%- endif -%}

            {%- if block.settings.icon_svg != blank -%}
              <span class="p5-trustbar__icon" aria-hidden="true">{{ block.settings.icon_svg }}</span>
            {%- elsif block.settings.icon_text != blank -%}
              <span class="p5-trustbar__icon" aria-hidden="true">{{ block.settings.icon_text | escape }}</span>
            {%- endif -%}

            <span class="p5-trustbar__text">{{ block.settings.text | escape }}</span>

            {%- if block.settings.link != blank -%}
              </a>
            {%- endif -%}
          </li>
        {%- endif -%}
      {%- endfor -%}
    </ul>

    {%- if section.settings.show_badges -%}
      <div class="p5-trustbar__badges" aria-label="Payment and trust badges">
        {%- if section.settings.badge_1 != blank -%}<span class="p5-trustbar__badge">{{ section.settings.badge_1 | escape }}</span>{%- endif -%}
        {%- if section.settings.badge_2 != blank -%}<span class="p5-trustbar__badge">{{ section.settings.badge_2 | escape }}</span>{%- endif -%}
        {%- if section.settings.badge_3 != blank -%}<span class="p5-trustbar__badge">{{ section.settings.badge_3 | escape }}</span>{%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% style %}
  .p5-trustbar {
    padding-top: var(--p5tb-padding-y);
    padding-bottom: var(--p5tb-padding-y);
  }

  .p5-trustbar__inner {
    max-width: var(--p5tb-max-width);
  }

  .p5-trustbar__heading {
    margin: 0 0 10px;
    opacity: 0.95;
  }

  .p5-trustbar__list {
    display: grid;
    grid-template-columns: repeat(var(--p5tb-cols, 4), minmax(0, 1fr));
    gap: var(--p5tb-gap);
    margin: 0;
    padding: 0;
    list-style: none;
    border-radius: var(--p5tb-radius);
    border: var(--p5tb-border) solid rgba(var(--color-foreground), 0.10);
    background: rgba(var(--color-background), var(--p5tb-bg-alpha));
    padding: 10px;
  }

  .p5-trustbar__item {
    min-width: 0;
  }

  .p5-trustbar__link,
  .p5-trustbar__item > span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 8px;
    border-radius: calc(var(--p5tb-radius) * 0.7);
    text-decoration: none;
    color: rgb(var(--color-foreground));
  }

  .p5-trustbar__link:hover {
    background: rgba(var(--color-foreground), 0.04);
  }

  .p5-trustbar__link:focus-visible {
    outline: 2px solid rgba(var(--color-foreground), 0.35);
    outline-offset: 2px;
  }

  .p5-trustbar__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--p5tb-icon-size);
    height: var(--p5tb-icon-size);
    font-size: var(--p5tb-icon-size);
    line-height: 1;
  }

  .p5-trustbar__icon svg {
    width: var(--p5tb-icon-size);
    height: var(--p5tb-icon-size);
    display: block;
  }

  .p5-trustbar__text {
    font-size: var(--p5tb-text-size);
    line-height: 1.2;
    text-align: center;
  }

  .p5-trustbar__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
    opacity: 0.9;
  }

  .p5-trustbar__badge {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(var(--color-foreground), 0.12);
    background: rgba(var(--color-background), 0.65);
    white-space: nowrap;
  }

  @media screen and (max-width: 989px) {
    .p5-trustbar__list { grid-template-columns: repeat(var(--p5tb-cols-md, 2), minmax(0, 1fr)); }
  }

  @media screen and (max-width: 749px) {
    .p5-trustbar__list { grid-template-columns: repeat(var(--p5tb-cols-sm, 1), minmax(0, 1fr)); }
    .p5-trustbar__heading { text-align: center; }
  }
{% endstyle %}

<script>
  (() => {
    const init = (root) => {
      const track = root.dataset.trackClicks === 'true';
      if (!track) return;

      root.querySelectorAll('[data-p5tb-link]').forEach((a) => {
        a.addEventListener('click', () => {
          const detail = {
            sectionId: root.dataset.sectionId,
            label: a.dataset.label || '',
            href: a.getAttribute('href') || ''
          };
          window.dispatchEvent(new CustomEvent('p5:trust_bar:click', { detail }));
        });
      });
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.p5-trustbar[data-section-id]').forEach(init);
    });
  })();
</script>

{% schema %}
{
  "name": "NZDev â€” Highlights Bar",
  "tag": "section",
  "class": "section",
  "max_blocks": 8,
  "settings": [
    {"type": "text", "id": "heading", "label": "Heading", "default": "Why shop with us"},
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "h5",
      "options": [
        {"value": "h6", "label": "Small"},
        {"value": "h5", "label": "Medium"},
        {"value": "h4", "label": "Large"}
      ]
    },
    {"type": "text", "id": "aria_label", "label": "ARIA label", "default": "Trust highlights"},

    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1",
      "options": [
        {"value": "accent-1", "label": "Accent 1"},
        {"value": "accent-2", "label": "Accent 2"},
        {"value": "background-1", "label": "Background 1"},
        {"value": "background-2", "label": "Background 2"},
        {"value": "inverse", "label": "Inverse"}
      ]
    },

    {"type": "header", "content": "Layout"},
    {"type": "range", "id": "max_width", "label": "Max width", "min": 600, "max": 1600, "step": 20, "unit": "px", "default": 1200},
    {"type": "range", "id": "padding_y", "label": "Vertical padding", "min": 0, "max": 80, "step": 4, "unit": "px", "default": 12},
    {"type": "range", "id": "gap", "label": "Item gap", "min": 0, "max": 32, "step": 2, "unit": "px", "default": 12},
    {"type": "range", "id": "radius", "label": "Corner radius", "min": 0, "max": 24, "step": 2, "unit": "px", "default": 10},
    {"type": "range", "id": "border_width", "label": "Border width", "min": 0, "max": 4, "step": 1, "unit": "px", "default": 1},
    {"type": "range", "id": "bg_alpha", "label": "Background opacity", "min": 0, "max": 100, "step": 5, "unit": "%", "default": 60},

    {"type": "header", "content": "Responsive"},
    {"type": "range", "id": "cols", "label": "Columns (desktop)", "min": 1, "max": 6, "step": 1, "default": 4},
    {"type": "range", "id": "cols_md", "label": "Columns (tablet)", "min": 1, "max": 4, "step": 1, "default": 2},
    {"type": "range", "id": "cols_sm", "label": "Columns (mobile)", "min": 1, "max": 2, "step": 1, "default": 1},

    {"type": "header", "content": "Typography"},
    {"type": "range", "id": "text_size", "label": "Text size", "min": 10, "max": 18, "step": 1, "unit": "px", "default": 13},
    {"type": "range", "id": "icon_size", "label": "Icon size", "min": 14, "max": 30, "step": 2, "unit": "px", "default": 18},

    {"type": "header", "content": "Badges"},
    {"type": "checkbox", "id": "show_badges", "label": "Show badges row", "default": true},
    {"type": "text", "id": "badge_1", "label": "Badge 1", "default": "Afterpay"},
    {"type": "text", "id": "badge_2", "label": "Badge 2", "default": "Secure checkout"},
    {"type": "text", "id": "badge_3", "label": "Badge 3", "default": "Fast dispatch"},

    {"type": "header", "content": "Tracking"},
    {"type": "checkbox", "id": "track_clicks", "label": "Track clicks (dispatch CustomEvent)", "default": false}
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Highlight",
      "settings": [
        {"type": "text", "id": "text", "label": "Text", "default": "30-day returns"},
        {"type": "text", "id": "icon_text", "label": "Icon (emoji/text)", "default": "âœ…"},
        {"type": "textarea", "id": "icon_svg", "label": "Icon SVG (optional)", "info": "Paste raw SVG markup. If provided, it overrides Icon text."},
        {"type": "url", "id": "link", "label": "Link (optional)"},
        {"type": "checkbox", "id": "open_in_new_tab", "label": "Open link in new tab", "default": false}
      ]
    }
  ],
  "presets": [
    {
      "name": "NZDev â€” Highlights Bar",
      "blocks": [
        {"type": "item", "settings": {"text": "Fast dispatch", "icon_text": "ðŸšš"}},
        {"type": "item", "settings": {"text": "Secure checkout", "icon_text": "ðŸ”’"}},
        {"type": "item", "settings": {"text": "30-day returns", "icon_text": "âœ…"}},
        {"type": "item", "settings": {"text": "Ships from NZ", "icon_text": "ðŸ‡³ðŸ‡¿"}}
      ]
    }
  ]
}
{% endschema %}
